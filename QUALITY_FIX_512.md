# üé® –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ - 512px + –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:

**384x384 - –∑–∞–Ω–∞–¥—Ç–æ –º–∞–ª–æ!**
- –í—Ç—Ä–∞—Ç–∞ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—ñ
- "–ë–ª–æ—á–Ω—ñ—Å—Ç—å" —Ç–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏
- –†–æ–∑–º–∏—Ç—ñ –∫—Ä–∞—ó
- –ü–æ–≥–∞–Ω–∞ —è–∫—ñ—Å—Ç—å –Ω–∞ –≤–µ–ª–∏–∫–∏—Ö —Ñ–æ—Ç–æ

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è:

### 1. **–ó–±—ñ–ª—å—à–µ–Ω–æ –¥–æ 512x512** üöÄ
```kotlin
private val contentImageSize = 512  // –ë—É–ª–æ: 384
```

**–ß–æ–º—É 512?**
- ‚úÖ Magenta v2 –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–æ 640x640
- ‚úÖ 512 - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å —è–∫—ñ—Å—Ç—å/—à–≤–∏–¥–∫—ñ—Å—Ç—å
- ‚úÖ –ù–µ –∫—Ä–∞—à–∏—Ç—å—Å—è –Ω–∞ –±—ñ–ª—å—à–æ—Å—Ç—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
- ‚úÖ +33% –±—ñ–ª—å—à–µ –ø—ñ–∫—Å–µ–ª—ñ–≤ –Ω—ñ–∂ 384

### 2. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä** üéØ
```kotlin
private fun calculateOptimalSize(width: Int, height: Int, maxSize: Int): Int {
    val minDimension = minOf(width, height)
    return when {
        minDimension >= maxSize -> maxSize           // –í–µ–ª–∏–∫–µ —Ñ–æ—Ç–æ ‚Üí 512
        minDimension >= maxSize * 0.75 -> 384        // –°–µ—Ä–µ–¥–Ω—î ‚Üí 384
        else -> minOf(minDimension, maxSize / 2)     // –ú–∞–ª–µ ‚Üí 256
    }.coerceIn(256, maxSize)
}
```

**–õ–æ–≥—ñ–∫–∞:**
- –í–µ–ª–∏–∫–µ —Ñ–æ—Ç–æ (‚â•512px) ‚Üí –æ–±—Ä–æ–±–ª—è—î –≤ 512x512
- –°–µ—Ä–µ–¥–Ω—î —Ñ–æ—Ç–æ (384-512px) ‚Üí –æ–±—Ä–æ–±–ª—è—î –≤ 384x384
- –ú–∞–ª–µ —Ñ–æ—Ç–æ (<384px) ‚Üí –æ–±—Ä–æ–±–ª—è—î –≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä–æ–∑–º—ñ—Ä—ñ
- **–ù–µ –≤–∏—Ç—Ä–∞—á–∞—î –ø–∞–º'—è—Ç—å –Ω–∞ –º–∞–ª–µ–Ω—å–∫—ñ —Ñ–æ—Ç–æ!**

### 3. **–í–∏—Å–æ–∫–æ—è–∫—ñ—Å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è** üñºÔ∏è
```kotlin
private fun createHighQualityScaledBitmap(source: Bitmap, width: Int, height: Int): Bitmap {
    val paint = Paint().apply {
        isAntiAlias = true      // –ó–≥–ª–∞–¥–∂—É–≤–∞–Ω–Ω—è –∫—Ä–∞—ó–≤
        isFilterBitmap = true   // –ë—ñ–ª—ñ–Ω–µ–∞—Ä–Ω–∞ —ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è
        isDither = true         // –î–∏–∑–µ—Ä—ñ–Ω–≥ –¥–ª—è –ø–ª–∞–≤–Ω–∏—Ö –≥—Ä–∞–¥—ñ—î–Ω—Ç—ñ–≤
    }
    canvas.drawBitmap(source, srcRect, dstRect, paint)
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ AntiAlias ‚Üí –ø–ª–∞–≤–Ω—ñ –∫—Ä–∞—ó
- ‚úÖ FilterBitmap ‚Üí –∫—Ä–∞—â–∞ —ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è
- ‚úÖ Dither ‚Üí –º–µ–Ω—à–µ –±–∞–Ω–¥—ñ–Ω–≥—É –Ω–∞ –≥—Ä–∞–¥—ñ—î–Ω—Ç–∞—Ö

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è:

### –ë—É–ª–æ (384px):
- ‚ö†Ô∏è 384 √ó 384 = **147,456 –ø—ñ–∫—Å–µ–ª—ñ–≤**
- ‚ö†Ô∏è –í—Ç—Ä–∞—Ç–∞ –¥–µ—Ç–∞–ª–µ–π
- ‚ö†Ô∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ –ø—Ä–∏ –∞–ø—Å–∫–µ–π–ª—ñ
- ‚ö†Ô∏è –†–æ–∑–º–∏—Ç—ñ –∫—Ä–∞—ó

### –°—Ç–∞–ª–æ (512px –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π):
- ‚úÖ 512 √ó 512 = **262,144 –ø—ñ–∫—Å–µ–ª—ñ–≤** (+78%!)
- ‚úÖ –ë—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π
- ‚úÖ –ú–µ–Ω—à–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤
- ‚úÖ –ß—ñ—Ç–∫—ñ—à—ñ –∫—Ä–∞—ó
- ‚úÖ –ê–¥–∞–ø—Ç—É—î—Ç—å—Å—è –¥–æ —Ä–æ–∑–º—ñ—Ä—É —Ñ–æ—Ç–æ

## üéØ –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:

### –Ø–∫—ñ—Å—Ç—å:
- üé® **–ó–Ω–∞—á–Ω–æ –∫—Ä–∞—â–∞ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è**
- üé® –ú–µ–Ω—à–µ "–±–ª–æ—á–Ω–æ—Å—Ç—ñ"
- üé® –ü–ª–∞–≤–Ω—ñ—à—ñ –≥—Ä–∞–¥—ñ—î–Ω—Ç–∏
- üé® –ß—ñ—Ç–∫—ñ—à—ñ –∫—Ä–∞—ó —Ç–∞ —Ç–µ–∫—Å—Ç—É—Ä–∏
- üé® –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∞ —è–∫—ñ—Å—Ç—å

### –®–≤–∏–¥–∫—ñ—Å—Ç—å:
- ‚è±Ô∏è –¢—Ä–æ—Ö–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ (512 vs 384)
- ‚è±Ô∏è –ê–ª–µ XNNPACK –∫–æ–º–ø–µ–Ω—Å—É—î
- ‚è±Ô∏è –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –µ–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–æ—Ç–æ
- ‚è±Ô∏è ~2-4 —Å–µ–∫—É–Ω–¥–∏ –Ω–∞ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó

### –ü–∞–º'—è—Ç—å:
- üíæ 512√ó512√ó4 = 1 MB (–±—É–ª–æ 0.6 MB)
- üíæ –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –µ–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–æ—Ç–æ
- üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö bitmap

## ‚ö†Ô∏è –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:

### –Ø–∫—â–æ –∫—Ä–∞—à–∏—Ç—å—Å—è:
1. **OutOfMemoryError** ‚Üí –∑–º–µ–Ω—à–∏ –¥–æ 384
2. **–ü–æ–≤—ñ–ª—å–Ω–æ** ‚Üí –∑–º–µ–Ω—à–∏ –¥–æ 384
3. **–ù–∞ —Å—Ç–∞—Ä–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö** ‚Üí fallback –Ω–∞ 256

### –Ø–∫ –∑–º–µ–Ω—à–∏—Ç–∏ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:
```kotlin
// –£ StyleTransferModel.kt
private val contentImageSize = 384  // –ê–±–æ 256
```

## üîç –õ–æ–≥–∏ (—â–æ –ø–æ–±–∞—á–∏—à):

### –í–µ–ª–∏–∫–µ —Ñ–æ—Ç–æ (1920x1080):
```
D/StyleTransfer: Scaling bitmap from 1920x1080 to 512x512
```

### –°–µ—Ä–µ–¥–Ω—î —Ñ–æ—Ç–æ (800x600):
```
D/StyleTransfer: Scaling bitmap from 800x600 to 384x384
```

### –ú–∞–ª–µ —Ñ–æ—Ç–æ (300x300):
```
D/StyleTransfer: Scaling bitmap from 300x300 to 256x256
```

## üí° –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏ –¥–ª—è —è–∫–æ—Å—Ç—ñ:

### 1. **–Ø–∫—ñ—Å–Ω—ñ style images**
- –ú—ñ–Ω—ñ–º—É–º 512x512 –ø—ñ–∫—Å–µ–ª—ñ–≤
- –ß—ñ—Ç–∫—ñ, –Ω–µ —Å—Ç–∏—Å–Ω—É—Ç—ñ JPEG
- –Ø—Å–∫—Ä–∞–≤—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å—Ç–∏–ª—é

### 2. **–í—Ö—ñ–¥–Ω—ñ —Ñ–æ—Ç–æ**
- –î–æ–±—Ä–µ –æ—Å–≤—ñ—Ç–ª–µ–Ω—ñ
- –ß—ñ—Ç–∫—ñ –¥–µ—Ç–∞–ª—ñ
- –ù–µ –¥—É–∂–µ —Ç–µ–º–Ω—ñ

### 3. **–Ø–∫—ñ —Å—Ç–∏–ª—ñ –ø—Ä–∞—Ü—é—é—Ç—å –∫—Ä–∞—â–µ:**
- **–ü–æ—Ä—Ç—Ä–µ—Ç–∏**: Van Gogh, Oil Painting
- **–ü–µ–π–∑–∞–∂—ñ**: Impressionism, Watercolor
- **–û–±'—î–∫—Ç–∏**: Pop Art, Cartoon
- **–ß–æ—Ä–Ω–æ-–±—ñ–ª—ñ**: Pencil Sketch

## üöÄ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:

1. **–í—Å—Ç–∞–Ω–æ–≤–∏ –Ω–æ–≤–∏–π APK**
2. **–°–ø—Ä–æ–±—É–π –Ω–∞ –≤–µ–ª–∏–∫–æ–º—É —Ñ–æ—Ç–æ** (1920x1080+)
3. **–ü–æ—Ä—ñ–≤–Ω—è–π –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—é –≤–µ—Ä—Å—ñ—î—é**
4. **–Ø–∫—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –ù–ê–ë–ê–ì–ê–¢–û –∫—Ä–∞—â–∞!**

## üìù –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ:

### –†–æ–∑–º—ñ—Ä–∏ –æ–±—Ä–æ–±–∫–∏:
- **Style image**: 256x256 (—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ)
- **Content image**: 256-512 (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- **Output**: –ú–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è –¥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É

### –ê–ª–≥–æ—Ä–∏—Ç–º –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è:
1. –í–∏–∑–Ω–∞—á–∞—î –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä
2. –ú–∞—Å—à—Ç–∞–±—É—î –∑ AntiAlias + Filter + Dither
3. –û–±—Ä–æ–±–ª—è—î —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å
4. –ú–∞—Å—à—Ç–∞–±—É—î –Ω–∞–∑–∞–¥ –∑ –≤–∏—Å–æ–∫–æ—é —è–∫—ñ—Å—Ç—é

### –ü–µ—Ä–µ–≤–∞–≥–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É:
- –í–µ–ª–∏–∫—ñ —Ñ–æ—Ç–æ ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —è–∫—ñ—Å—Ç—å (512)
- –°–µ—Ä–µ–¥–Ω—ñ —Ñ–æ—Ç–æ ‚Üí –±–∞–ª–∞–Ω—Å (384)
- –ú–∞–ª—ñ —Ñ–æ—Ç–æ ‚Üí –µ–∫–æ–Ω–æ–º—ñ—è –ø–∞–º'—è—Ç—ñ (256)

## ‚úÖ –ü—ñ–¥—Å—É–º–æ–∫:

**–ó–∞—Ä–∞–∑ –¥–æ–¥–∞—Ç–æ–∫:**
- ‚úÖ –û–±—Ä–æ–±–ª—è—î –¥–æ 512x512 (+78% –ø—ñ–∫—Å–µ–ª—ñ–≤)
- ‚úÖ –ê–¥–∞–ø—Ç—É—î—Ç—å—Å—è –¥–æ —Ä–æ–∑–º—ñ—Ä—É —Ñ–æ—Ç–æ
- ‚úÖ –í–∏—Å–æ–∫–æ—è–∫—ñ—Å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- ‚úÖ v2 fp16 –º–æ–¥–µ–ª—ñ
- ‚úÖ XNNPACK –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è
- ‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –ø–∞–º'—è—Ç—å

**–Ø–∫—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –ó–ù–ê–ß–ù–û –∫—Ä–∞—â–∞!** üé®‚ú®

–Ø–∫—â–æ –≤—Å–µ —â–µ –Ω–µ –∑–∞–¥–æ–≤–æ–ª—å–Ω—è—î - –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏:
1. –ó–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ 640 (–º–æ–∂–µ –∫—Ä–∞—à–∏—Ç–∏—Å—å)
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —è–∫—ñ—Å—Ç—å style images
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —ñ–Ω—à—ñ –º–æ–¥–µ–ª—ñ (–Ω–µ Magenta)
